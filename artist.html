<html>
    <head>
        <title>Billboard Chart Visualization</title>
        <script type="text/javascript" src="d3.v2.min.js"></script>
        <style type="text/css">
            .data-line {
                stroke-width: 2;
                fill: none;
                stroke-dasharray: 0;
            }

            .coordinates {
                stroke-width: 2;
                fill: none;
                stroke-dasharray: 0;
            }

            .point {
                stroke: #aaa;
                fill: white;
                stroke-width: 2;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
            var width = 1300,
                height = 1000,
                padding = 30,
                radius = Math.min(width, height) / 2,
                colorScale = d3.scale.category20c();    

            var years = 23;
            var angle = 2*Math.PI/years;

            var coordinates = [];
            var temp = [];
            for(i = 0; i < years; i++){
                temp = [i, i];
                coordinates.push(temp);
            }

            var rScale = d3.scale.linear().domain([100, 0]).range([0, radius - padding]);

            var vis = d3.select("body").append("svg")
                         .attr("width", width)
                         .attr("height", height)
                      .append("svg:g")
                         .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var line = d3.svg.line()
                                 .x(function(d, i){
                                    //console.log(d);
                                    r = rScale(d.rank);
                                    alpha = (d.year - 1990)*angle-Math.PI/2;
                                    return r*Math.cos(alpha);
                                 })
                                 .y(function(d){
                                    r = rScale(d.rank);
                                    alpha = (d.year - 1990)*angle-Math.PI/2;
                                    return r*Math.sin(alpha);
                                 })
                                 .interpolate("cardinal");
           
            var coor = d3.svg.line()
                                .x(function(d, i){
                                    return Math.cos(d*angle-Math.PI/2)*i*radius;
                                })
                                .y(function(d, i){
                                    return Math.sin(d*angle-Math.PI/2)*i*radius;
                                })
                                .interpolate("linear");

            vis.selectAll(".coordinates")
                        .data(coordinates)
                        .enter()
                        .append("svg:g")
                        .append("path")
                        .attr("class", "coordinates")
                        .attr("stroke", "#ccc")
                        .attr("opacity", 0.8)
                        .attr("d", coor);

            var url = window.location.href;
            var query = url.split("?")[1].split("=")[1];
            var query = unescape(query);
            //console.log(query);
            
            d3.json("artist.json", function(json){

                    var data = json[query];
                    if(data!=undefined){
                        var path = vis.selectAll(".data-line")
                            .data([data])
                            .enter()
                            .append("svg:g");

                        path.append("path")
                            .attr("class", "data-line")
                            .attr("stroke", "#FF2240")
                            .attr("opacity", 0.8)
                            .attr("d", line);

                        

                        path.selectAll(".point")
                            .data(function(d){return d})
                            .enter().append("svg:circle")
                                .attr("class", 'point')
                                .attr("r", 4)
                                .attr("cx", function(d, i){
                                    r = rScale(d.rank);
                                    alpha = (d.year - 1990)*angle-Math.PI/2;
                                    return r*Math.cos(alpha);
                                })
                                .attr("cy", function(d){
                                    r = rScale(d.rank);
                                    alpha = (d.year - 1990)*angle-Math.PI/2;
                                    return r*Math.sin(alpha);
                                })
                                .on('mouseover', function(){return d3.select(this).attr('r', 8)})
                                .on('mouseout', function(){return d3.select(this).attr('r', 3)})
                                .on('click', function(d, i){ alert(d.year+" "+d.rank+" "+d.track) });
                        }
                });

        </script>
    </body>
</html>